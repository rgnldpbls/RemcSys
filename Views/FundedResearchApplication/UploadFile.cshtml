@{
    Layout = "_NavTeamLeader";
    var staffList = ViewBag.ResearchStaff as List<ResearchStaff>;
}
<div class="application-requirements">
    <h1>Application Requirements</h1>

    <div class="research-info">
        <h2><b>Research Title:</b>@ViewBag.ResearchTitle </h2>
        <h6><b>Proponents:</b>
            <br />@ViewBag.Proponent 
            <br />
            @foreach(var staff in staffList)
            {
                @staff.rs_Name
                <br />
            } 
        </h6>
    </div>



    <div class="upload-container">
        <!-- Your Attachments -->
        <div class="upload-section">
            <h3>Your Attachments</h3><hr />
            <p><b>NOTE:</b> Please follow the file naming format (Ex: FORM # - FormName)</p>

            <div class="attachments">
                <ul id="fileList" class="list-group mt-3"></ul>
            </div>
        </div>

        <!-- Upload and Submit button -->
            <div class="file-upload-section">
                <h3>Your Uploads</h3><hr />
                <form id="applicationForm" asp-action="UploadFile" method="post" enctype="multipart/form-data">
                    <label for="fileUpload" class="upload-btn">
                        <span class="upload-icon">+</span> Upload Files
                    </label>
                    <input type="file" id="fileUpload" name="files" multiple style="display:none;">

                    <button type="submit" class="submit-btn">SUBMIT APPLICATION</button>
                </form>
            </div>
    </div>
</div>

<!-- Warning Pop-up -->
<div class="warning_section" style="display:none">
    <div class="card">
        <i class="bi bi-exclamation-circle-fill" style="font-size: 100px; color:#850000; text-align: center;"></i>
        <span class="title">Please review all information before submitting.</span>
        <div class="d-grid gap-3 col-14 mx-auto">
            <p>Changes may not be possible after submission.</p>
        </div>
       @*  <a class="wsubmit-btn" href="#"
           style="position: absolute; background-color: #FFDB89;color: #850000; bottom: 10px;right: 10px;font-size: 20px;width: 150px;height: 50px;font-weight: 500;border: 1px #FFDB89;border-radius: 5px; text-align: center; margin-top: 10px;line-height: 50px;"> Submit</a> *@
        <button class="wback-btn">Back</button>
    </div>
</div>

@section Scripts{
    <script>
        let selectedFiles = [];

        function renderFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            selectedFiles.forEach((file, index) => {
                const li = document.createElement('li');
                li.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center');

                const fileLink = document.createElement('a');
                if (file.type === "application/pdf") {
                    fileLink.href = URL.createObjectURL(file); // Preview PDF in a new tab
                    fileLink.target = '_blank';
                }
                fileLink.textContent = file.name;
                li.appendChild(fileLink);

                const removeBtn = document.createElement('button');
                removeBtn.classList.add('btn', 'btn-danger', 'btn-sm');
                removeBtn.textContent = 'x';
                removeBtn.onclick = () => {
                    selectedFiles.splice(index, 1); // Remove file from array
                    renderFileList();
                };
                li.appendChild(removeBtn);

                fileList.appendChild(li);
            });
        }

        document.getElementById('fileUpload').addEventListener('change', function (event) {
            const files = event.target.files;
            for (let i = 0; i < files.length; i++) {
                selectedFiles.push(files[i]); // Add selected files to array
            }
            renderFileList();
        });

        document.querySelector('.submit-btn').addEventListener('click', function () {
            document.querySelector('.warning_section').style.display = 'block';
        });

        document.querySelector('.wback-btn').addEventListener('click', function () {
            document.querySelector('.warning_section').style.display = 'none';
        });

        /*document.querySelector('.wsubmit-btn').addEventListener('click', function () {
            const formData = new FormData();
            selectedFiles.forEach(file => {
                formData.append('files', file); // Append files to FormData
            });

            fetch('/FundedResearchApplication/UploadFile', {
                method: 'POST',
                body: formData
            }).then(response => {
                if (response.ok) {
                    window.location.href = '@Url.Action("ApplicationSuccess", "FundedResearchApplication")';
                } else {
                    alert('File upload failed.');
                }
            }).catch(error => {
                console.error('Error:', error);
                alert('Error occured during file upload.');
            });
        });*/
    </script>
}